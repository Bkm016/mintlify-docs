---
title: "运行时注解与可选参数"
description: "@Optional、@Export 等注解在 runtime-core 中的作用"
---

Fluxon runtime 暴露了少量注解用于描述导出方法的参数语义，主要位于 `core/runtime/java` 包。

## `@Export`

- 标记在任意 public 方法上，表示该方法应被 `ExportRegistry` 收集。
- 可结合 `namespace` 注册到不同命名空间。
- 方法名会经过 `StringUtils.transformMethodName`，去掉标准 getter 前缀。

## `@Optional`

- 用于方法参数，表示从该参数开始均为可选。
- `ExportRegistry` 在分析参数时会生成一系列 `List<Integer>`，覆盖必选参数数量到总参数数量之间的所有值。
- 示例：

```java
@Export
public String encode(String text, @Optional String charset) { ... }
```

生成的 `params` = `[1, 2]`，脚本可只传一个参数。

## 其他注解

虽然当前源码中仅包含上述两个注解，但 `ExportMethod` 预留了布尔标记以区分 `async` / `primarySync`。如果需要自定义语义，可以扩展注解并在 `ExportRegistry` 中解析。例如：

```java
@Retention(RUNTIME)
@Target(METHOD)
public @interface ExportAsync {}
```

然后在扫描时设置 `ExportMethod#setAsync(true)`，最终由 `registerAsyncExtensionFunction` 注册。

## 与 `FunctionContext` 配合

- 注解提供的参数个数信息会直接影响 `FunctionContext#hasArgument` 行为。
- 如果脚本传入的参数少于必需值，解释器会在语义分析阶段报错；若类型不匹配，则 `ArgumentTypeMismatchError` 会包含期望类型与实际值，便于排查。
